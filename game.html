<!doctype html>
<html>
<head>
    <meta charset ="utf-8"/>
    <title>My engine</title>
    <style>
        canvas{
            position: absolute;
            top: 0px;
            bottom: 0px;
            left: 0px;
            right: 0px;
            margin: auto;
        }
    </style>

</head>
<body>
    <script>
        //variÃ¡veis do jogo
        var canvas, ctx, _HEIGHT, _WIDTH, frames = 0, maxJump = 3, speed = 6,

        ground = {
           y:550,
           _height:50,
           _color:"#e8da78",

           draw: function(){
               ctx.fillStyle = this._color;
               ctx.fillRect (0,this.y,_WIDTH, this._height);
           }
        },

        bloc = {
            x:50,
            y:0,
            _height:50,
            _width:50,
            _color:"#ff4e4e",
            gravity: 1.6,
            speed: 0,
            jumpStrength: 23.6,
            jumpCount: 0,

            updates:function(){
                this.speed += this.gravity;
                this.y += this.speed;

                if (this.y > ground.y - this._height){
                    this.y = ground.y - this._height
                    this.jumpCount = 0;
                }
            },
            jump:function(){
                if(this.jumpCount < maxJump){
                    this.speed = - this.jumpStrength;
                    this.jumpCount++;
                 }
            },
            draw:function(){
                ctx.fillStyle = this._color;
                ctx.fillRect (this.x, this.y,this._width,this._height);
            }
        };

        obstacles = {
             _obs: [],
            colors: ["#ff9c1c","#6b1cff","#d646b2","#3c7fc4","#48964d"],
            insertingTime: 0,

            insert :function(){
                this._obs.push({
                    x: _WIDTH,
                    _width: 30 + Math.floor(21 * Math.random()),
                    _height: 30 + Math.floor(120 * Math.random()),
                    _color: this.colors[Math.floor(5 * Math.random())]
                });

                this.insertingTime = 30 + Math.floor(21 * Math.random());
            },

            updates:function(){
                if(this.insertingTime == 0)
                    this.insert();
                    else
                        this.insertingTime--;

                for(var i = 0,  tam = this._obs.length; i < tam; i++){
                    var obs = this._obs[i];

                    obs.x -= speed;

                    if(obs.x <= -obs._width){
                        this._obs.splice(i, 1)
                        tam--;
                        i--;

                    }
                }
            },
            draw:function(){
                for(var i = 0, tam = this._obs.length; i < tam; i++){
                    var obs = this._obs[i];
                    ctx.fillStyle = obs._color;
                    ctx.fillRect(obs.x, ground.y - obs._height, obs._width, obs._height);
                }
            }
        };
        
        function click(event){
            bloc.jump();

        }

        function main(){
            _HEIGHT = window.innerHeight;
            _WIDTH =window.innerWidth;

            if(_WIDTH >= 500){
                _WIDTH = 600;
                _HEIGHT = 600;
            }
            canvas =document.createElement("canvas");
            canvas.width = _WIDTH;
            canvas.height = _HEIGHT;
            canvas.style.border = "1px solid #000";
            
            ctx = canvas.getContext("2d");
            document.body.appendChild(canvas);
            document.addEventListener("mousedown", click);

            reload();
        }

        function reload(){
            updates();
            draw();

            window.requestAnimationFrame(reload);
        }

        function updates(){
            frames++;

            bloc.updates();
            obstacles.updates();
        }

        function draw(){
            ctx.fillStyle = "#80daff";
            ctx.fillRect(0,0,_WIDTH, _HEIGHT);

            ground.draw();
            obstacles.draw();
            bloc.draw();
        }

        //inicializa o jogo 
        main();
    </script>
</body>
</html>